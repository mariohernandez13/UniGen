<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UniGen | Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='../static/CSS/dashboard.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='../static/CSS/navbar.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='../static/CSS/modales.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='../static/CSS/footer.css') }}">
    <link rel="icon" href="../static/IMAGES/logo_unigen.svg" class="imagen">

</head>

<body>

    <nav class="navbar navbar-expand-lg navbar-expand-md px-4">
        <a class="navbar-brand d-flex align-items-center" href="inicio">
            <img src="../static/IMAGES/logo_unigen.svg" width="50px" height="auto">
            <span class="ms-2 fw-bold logo-text" style="font-size: 1.5rem; letter-spacing: 1px;">UniGen</span>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup"
            aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="ms-auto collapse navbar-collapse" id="navbarNavAltMarkup">
            <div class="navbar-nav ms-5">
                <a class="nav-link px-3 " href="inicio" id="link1"><i class="fa-solid fa-house"></i> Inicio</a>
                <a class="nav-link px-3 active " href="dashboard" id="link2"><i class="fa-solid fa-file-pen"></i>
                    Actividades</a>
                <a class="nav-link px-3" href="tienda" id="link3"><i class="fa-solid fa-cart-shopping"></i> Tienda</a>
                <a class="nav-link px-3" href="sobrenosotros" id="link4"><i class="fa-solid fa-circle-info"></i> Sobre
                    nosotros</a>
                <a class="nav-link px-3" href="#" id="link5" data-bs-toggle="modal" data-bs-target="#contactModal"><i
                        class="fa-solid fa-paper-plane"></i> Contacto</a>
                <a class="nav-link px-3" href="modal_Usuario" id="link6"><i class="fa-solid fa-user"></i> Mi perfil</a>
            </div>
            <a class="nav-link px-3 ms-auto" href="/" id="link7" style="margin-left: auto;"><i
                    class="fa-solid fa-right-from-bracket"></i> Cerrar Sesion</a>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Mostrar mensajes flash -->
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div class="alert-container">
            {% for category, message in messages %}
            <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}
    </div>

    <!-- Creación de actividades -->
    <div class="container mt-5">
        <!-- Navegación de secciones -->
        <ul class="nav nav-pills mb-4 justify-content-center" id="actividadesTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link {% if active_tab == 'crear' %}active{% endif %}" id="crear-tab"
                    data-bs-toggle="pill" data-bs-target="#crear" type="button" role="tab">Crear Actividad</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link {% if active_tab == 'disponibles' %}active{% endif %}" id="disponibles-tab"
                    data-bs-toggle="pill" data-bs-target="#disponibles" type="button" role="tab">Disponibles</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link {% if active_tab == 'creadas' %}active{% endif %}" id="creadas-tab"
                    data-bs-toggle="pill" data-bs-target="#creadas" type="button" role="tab">Mis Actividades</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link {% if active_tab == 'apuntado' %}active{% endif %}" id="apuntado-tab"
                    data-bs-toggle="pill" data-bs-target="#apuntado" type="button" role="tab">Apuntado</button>
            </li>
        </ul>


        <div class="tab-content" id="actividadesTabsContent">
            <!-- Crear Actividad -->
            <div class="tab-pane fade {% if active_tab == 'crear' %}show active{% endif %}" id="crear" role="tabpanel">
                <div class="card p-4 mb-4">
                    <h3 class="mb-3">Crear nueva actividad</h3>
                    <form class="form row g-3" action="{{ url_for('crear_actividad') }}" method="POST"
                        enctype="multipart/form-data">
                        <div class="col-md-6">
                            <label class="form-label">Nombre</label>
                            <input required type="text" class="form-control" name="nombre">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Tipo</label>
                            <select required class="form-select" name="tipo">
                                <option value="" disabled selected>Selecciona un tipo</option>
                                <option value="ocio">Ocio</option>
                                <option value="deporte">Deporte</option>
                                <option value="curso">Curso</option>
                                <option value="taller">Taller</option>
                                <option value="charla">Charla</option>
                                <option value="ayuda">Ayuda</option>
                            </select>
                        </div>
                        <div class="col-md-12">
                            <label class="form-label">Descripción</label>
                            <textarea required class="form-control" name="descripcion" rows="2"></textarea>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Lugar</label>
                            <input required type="text" class="form-control" name="lugar">
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Fecha</label>
                            <input required type="date" class="form-control" name="fecha">
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Hora</label>
                            <input required type="time" class="form-control" name="hora">
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Duración (min)</label>
                            <input required type="number" class="form-control" name="duracion">
                        </div>
                        <div class="col-12">
                            <button class="btn btn-success w-100" type="submit">Crear Actividad</button>
                        </div>
                    </form>
                </div>
            </div>


            <!-- Actividades Disponibles -->
            <div class="tab-pane fade {% if active_tab == 'disponibles' %}show active{% endif %}" id="disponibles"
                role="tabpanel">
                <div class="card p-4 mb-4">
                    <h3 class="mb-3">Filtrar actividades</h3>
                    <form class="row g-3 mb-4" id="filtroForm" method="get">
                        <div class="col-md-3">
                            <select class="form-select" name="tipo" id="filtroTipo">
                                <option value="">Tipo (todos)</option>
                                <option value="Ocio">Ocio</option>
                                <option value="Deporte">Deporte</option>
                                <option value="Curso">Curso</option>
                                <option value="Taller">Taller</option>
                                <option value="Charla">Charla</option>
                                <option value="Ayuda">Ayuda</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <input type="date" class="form-control" name="fecha" id="filtroFecha">
                        </div>
                        <div class="col-md-3">
                            <input type="text" class="form-control" name="lugar" id="filtroLugar" placeholder="Lugar">
                        </div>
                        <div class="col-md-3">
                            <button type="submit" class="btn btn-primary w-100">Filtrar</button>
                        </div>
                    </form>
                    <div id="actividadesDisponibles">
                        <div class="row row-cols-1 row-cols-md-2 g-5 justify-content-center">
                            {% for actividad in actividades_disponibles %}
                            <div class="col">
                                <div class="card actividad-card shadow-lg w-100 text-white position-relative overflow-hidden p-0"
                                    style="min-height: 260px;">
                                    <div class="actividad-bg"
                                        style="background-image: url('{{ url_for('static', filename='IMAGES/' + actividad.foto) }}');">
                                    </div>
                                    <div
                                        class="actividad-overlay d-flex flex-column justify-content-center align-items-start h-100 p-5">
                                        <h2 class="fw-bold mb-3"
                                            style="font-size: 2.7rem; letter-spacing: 1px; text-shadow: 0 2px 12px #0008;">
                                            {{ actividad.nombre }}</h2>
                                        <button class="btn btn-lg btn-primary ver-mas-btn px-5 py-3 mt-2"
                                            data-bs-toggle="modal"
                                            data-bs-target="#modalActividad{{ actividad.idactividad }}"
                                            style="font-size: 1.6rem; border-radius: 2rem; font-weight: 700; box-shadow: 0 2px 12px rgba(59,91,219,0.18);">
                                            Ver más
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Modal Detalle Actividad -->
                            <div class="modal fade" id="modalActividad{{ actividad.idactividad }}" tabindex="-1"
                                aria-labelledby="modalActividadLabel{{ actividad.idactividad }}" aria-hidden="true">
                                <div class="modal-dialog modal-xl modal-dialog-centered">
                                    <div class="modal-content rounded-4">
                                        <div class="modal-header" style="background: #f8fafc;">
                                            <h2 class="modal-title fw-bold w-100 text-center"
                                                id="modalActividadLabel{{ actividad.idactividad }}"
                                                style="font-size: 2.8rem; color: #3b5bdb; letter-spacing: 1px;">
                                                {{ actividad.nombre }}
                                            </h2>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                aria-label="Cerrar"></button>
                                        </div>
                                        <div class="modal-body px-5 py-4">
                                            <div class="mb-4 text-center">
                                                <span class="badge bg-primary fs-4 px-4 py-2 mb-3"
                                                    style="font-size: 1.5rem;">{{ actividad.tipo }}</span>
                                            </div>
                                            <ul class="list-unstyled mb-4" style="font-size: 2rem;">
                                                <li class="mb-3"><strong>📍 Lugar:</strong> <span
                                                        style="color:#3b5bdb;">{{ actividad.lugar }}</span></li>
                                                <li class="mb-3">
                                                    <strong>🗓️ Fecha:</strong>
                                                    <span style="color:#3b5bdb;">
                                                        {% set fecha = actividad.fecha.split(' ')[0] if ' ' in
                                                        actividad.fecha else actividad.fecha.split('T')[0] %}
                                                        {% set partes = fecha.split('-') %}
                                                        {{ partes[2] }}/{{ partes[1] }}/{{ partes[0] }}
                                                    </span>
                                                </li>
                                                <li class="mb-3"><strong>🕒 Hora:</strong> <span
                                                        style="color:#3b5bdb;">{{ actividad.hora }}</span></li>
                                                <li class="mb-3"><strong>⏳ Duración:</strong> <span
                                                        style="color:#3b5bdb;">{{ actividad.duracion }} min</span></li>
                                            </ul>
                                            <div class="mb-4">
                                                <h4 class="fw-bold text-secondary" style="font-size: 2.2rem;">
                                                    Descripción</h4>
                                                <p style="font-size: 1.7rem;">{{ actividad.descripcion }}</p>
                                            </div>
                                            <div class="mb-4">
                                                <h5 class="fw-bold mb-2" style="font-size: 2rem;">
                                                    Participantes inscritos: {{ actividad.num_participantes }}
                                                </h5>
                                                {% if actividad.num_participantes > 0 %}
                                                <ul class="list-group list-group-flush mb-4" style="font-size: 1.5rem;">
                                                    {% for participante in actividad.participantes %}
                                                    <li
                                                        class="list-group-item d-flex align-items-center justify-content-between">
                                                        <span class="flex-grow-1">{{ participante.nombre }}</span>
                                                        <span class="ms-3">
                                                            <button type="button"
                                                                class="btn btn-outline-info btn-sm me-2"
                                                                data-bs-toggle="modal"
                                                                data-bs-target="#modalPerfilUsuario{{ participante.idusuario }}"
                                                                title="Ver perfil"> Ver Perfil
                                                                <i class="bi bi-person-circle"></i>
                                                            </button>
                                                            {% if participante.creditos_validados == 0 or
                                                            participante.creditos_validados == '0' or
                                                            participante.creditos_validados is not true %}

                                                            <button type="button"
                                                                class="btn btn-outline-success btn-sm btn-validar-creditos"
                                                                data-idusuario="{{ participante.idusuario }}"
                                                                data-idactividad="{{ actividad.idactividad }}"
                                                                data-puntos="{{ actividad.puntos }}"
                                                                title="Validar créditos">
                                                                <i class="bi bi-patch-check"></i> Validar créditos
                                                            </button>
                                                            {% endif %}
                                                        </span>
                                                    </li>
                                                    {% endfor %}

                                                </ul>
                                                {% else %}
                                                <p class="text-muted" style="font-size: 1.3rem;">No hay participantes
                                                    aún.</p>
                                                {% endif %}
                                            </div>
                                            {% if actividad.idactividad in ids_inscrito %}
                                            <form
                                                action="{{ url_for('desinscribirse', actividad_id=actividad.idactividad) }}"
                                                method="POST" class="d-inline ms-2">
                                                <button type="submit" class="btn btn-danger btn-lg w-100"
                                                    style="font-size: 1.5rem; border-radius: 1.5rem;">
                                                    Desapuntarme
                                                </button>
                                            </form>
                                            {% else %}
                                            <form
                                                action="{{ url_for('inscribirse', actividad_id=actividad.idactividad) }}"
                                                method="POST" class="d-inline ms-2">
                                                <button type="submit" class="btn btn-success btn-lg w-100"
                                                    style="font-size: 1.5rem; border-radius: 1.5rem;">
                                                    Apuntarme
                                                </button>
                                            </form>
                                            {% endif %}
                                        </div>
                                        <div class="modal-footer" style="background: #f8fafc;">
                                            <button type="button" class="btn btn-secondary btn-lg"
                                                data-bs-dismiss="modal" style="font-size: 1.2rem;">Cerrar</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Fin Modal -->
                            {% endfor %}
                            {% if actividades_disponibles|length == 0 %}
                            <div class="col-12 text-center text-muted">No hay actividades disponibles.</div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Actividades Creadas -->
            <div class="tab-pane fade {% if active_tab == 'creadas' %}show active{% endif %}" id="creadas"
                role="tabpanel">
                <div class="card p-4 mb-4">
                    <h3 class="mb-3">Mis actividades creadas</h3>
                    <div class="row row-cols-1 row-cols-md-2 g-5 justify-content-center">
                        {% for actividad in actividades_creadas %}
                        <div class="col">
                            <div class="card actividad-card shadow-lg w-100 text-white position-relative overflow-hidden p-0"
                                style="min-height: 260px;">
                                <div class="actividad-bg"
                                    style="background-image: url('{{ url_for('static', filename='IMAGES/' + actividad.foto) }}');">
                                </div>
                                <div
                                    class="actividad-overlay d-flex flex-column justify-content-center align-items-start h-100 p-5">
                                    <h2 class="fw-bold mb-3"
                                        style="font-size: 2.7rem; letter-spacing: 1px; text-shadow: 0 2px 12px #0008;">
                                        {{ actividad.nombre }}</h2>
                                    <button class="btn btn-lg btn-primary ver-mas-btn px-5 py-3 mt-2"
                                        data-bs-toggle="modal"
                                        data-bs-target="#modalActividad{{ actividad.idactividad }}"
                                        style="font-size: 1.6rem; border-radius: 2rem; font-weight: 700; box-shadow: 0 2px 12px rgba(59,91,219,0.18);">
                                        Ver más
                                    </button>
                                    <button class="btn btn-warning ver-mas-btn px-4 py-3 mt-2 ms-2"
                                        style="font-size: 1.6rem; border-radius: 2rem; font-weight: 700; box-shadow: 0 2px 12px rgba(255,193,7,0.18);">
                                        Editar
                                    </button>
                                    <form action="{{ url_for('borrar_actividad', actividad_id=actividad.idactividad) }}"
                                        method="POST" class="d-inline ms-2">
                                        <button type="submit" class="btn btn-danger ver-mas-btn px-4 py-3 mt-2"
                                            style="font-size: 1.6rem; border-radius: 2rem; font-weight: 700; box-shadow: 0 2px 12px rgba(220,53,69,0.18);">
                                            Borrar
                                        </button>
                                    </form>
                                    </form>
                                </div>
                            </div>
                        </div>


                        <!-- Modal Detalle Actividad -->
                        <div class="modal fade" id="modalActividad{{ actividad.idactividad }}" tabindex="-1"
                            aria-labelledby="modalActividadLabel{{ actividad.idactividad }}" aria-hidden="true">
                            <div class="modal-dialog modal-xl modal-dialog-centered">
                                <div class="modal-content rounded-4">
                                    <div class="modal-header" style="background: #f8fafc;">
                                        <h2 class="modal-title fw-bold w-100 text-center"
                                            id="modalActividadLabel{{ actividad.idactividad }}"
                                            style="font-size: 2.8rem; color: #3b5bdb; letter-spacing: 1px;">
                                            {{ actividad.nombre }}
                                        </h2>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                            aria-label="Cerrar"></button>
                                    </div>
                                    <div class="modal-body px-5 py-4">
                                        <div class="mb-4 text-center">
                                            <span class="badge bg-primary fs-4 px-4 py-2 mb-3"
                                                style="font-size: 1.5rem;">{{ actividad.tipo }}</span>
                                        </div>
                                        <ul class="list-unstyled mb-4" style="font-size: 2rem;">
                                            <li class="mb-3"><strong>📍 Lugar:</strong> <span style="color:#3b5bdb;">{{
                                                    actividad.lugar }}</span></li>
                                            <li class="mb-3"><strong>🗓️ Fecha:</strong><span style="color:#3b5bdb;">
                                                    {% set fecha = actividad.fecha.split(' ')[0] if ' ' in
                                                    actividad.fecha else actividad.fecha.split('T')[0] %}
                                                    {% set partes = fecha.split('-') %}
                                                    {{ partes[2] }}/{{ partes[1] }}/{{ partes[0] }}
                                                </span></li>
                                            <li class="mb-3"><strong>🕒 Hora:</strong> <span style="color:#3b5bdb;">{{
                                                    actividad.hora }}</span></li>
                                            <li class="mb-3"><strong>⏳ Duración:</strong> <span
                                                    style="color:#3b5bdb;">{{ actividad.duracion }} min</span></li>
                                        </ul>
                                        <div class="mb-4">
                                            <h4 class="fw-bold text-secondary" style="font-size: 2.2rem;">Descripción
                                            </h4>
                                            <p style="font-size: 1.7rem;">{{ actividad.descripcion }}</p>
                                        </div>
                                        <div class="mb-4">
                                            <h5 class="fw-bold mb-2" style="font-size: 2rem;">
                                                Participantes inscritos: {{ actividad.num_participantes }}
                                            </h5>
                                            {% if actividad.num_participantes > 0 %}
                                            <ul class="list-group list-group-flush mb-4" style="font-size: 1.5rem;">
                                                {% for participante in actividad.participantes %}
                                                <li
                                                    class="list-group-item d-flex align-items-center justify-content-between">
                                                    <span class="flex-grow-1">{{ participante.nombre }}</span>
                                                    <span class="ms-3">
                                                        <button type="button" class="btn btn-outline-info btn-sm me-2"
                                                            data-bs-toggle="modal"
                                                            data-bs-target="#modalPerfilUsuario{{ participante.idusuario }}"
                                                            title="Ver perfil"> Ver Perfil
                                                            <i class="bi bi-person-circle"></i>
                                                        </button>
                                                        <button type="button"
                                                            class="btn btn-outline-success btn-sm btn-validar-creditos"
                                                            data-idusuario="{{ participante.idusuario }}"
                                                            data-idactividad="{{ actividad.idactividad }}"
                                                            data-puntos="{{ actividad.puntos }}"
                                                            title="Validar créditos">
                                                            <i class="bi bi-patch-check"></i> Validar créditos
                                                        </button>
                                                    </span>
                                                </li>
                                                {% endfor %}
                                            </ul>
                                            {% else %}
                                            <p class="text-muted" style="font-size: 1.3rem;">No hay participantes aún.
                                            </p>
                                            {% endif %}
                                        </div>
                                        {% if actividad.idactividad in ids_inscrito %}
                                        <form
                                            action="{{ url_for('desinscribirse', actividad_id=actividad.idactividad) }}"
                                            method="POST" class="d-inline ms-2">
                                            <button type="submit" class="btn btn-danger btn-lg w-100"
                                                style="font-size: 1.5rem; border-radius: 1.5rem;">
                                                Desapuntarme
                                            </button>
                                        </form>
                                        {% else %}
                                        <form action="{{ url_for('inscribirse', actividad_id=actividad.idactividad) }}"
                                            method="POST" class="d-inline ms-2">
                                            <button type="submit" class="btn btn-success btn-lg w-100"
                                                style="font-size: 1.5rem; border-radius: 1.5rem;">
                                                Apuntarme
                                            </button>
                                        </form>
                                        {% endif %}
                                    </div>
                                    <div class="modal-footer" style="background: #f8fafc;">
                                        <button type="button" class="btn btn-secondary btn-lg" data-bs-dismiss="modal"
                                            style="font-size: 1.2rem;">Cerrar</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Fin Modal -->
                        {% endfor %}
                        {% if actividades_creadas|length == 0 %}
                        <div class="col-12 text-center text-muted">No has creado ninguna actividad.</div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Actividades Apuntado -->
            <div class="tab-pane fade {% if active_tab == 'apuntado' %}show active{% endif %}" id="apuntado"
                role="tabpanel">
                <div class="card p-4 mb-4">
                    <h3 class="mb-3">Actividades a las que estoy apuntado</h3>
                    <div class="row row-cols-1 row-cols-md-2 g-5 justify-content-center">
                        {% for actividad in actividades_apuntado %}
                        <div class="col">
                            <div class="card actividad-card shadow-lg w-100 text-white position-relative overflow-hidden p-0"
                                style="min-height: 260px;">
                                <div class="actividad-bg"
                                    style="background-image: url('{{ url_for('static', filename='IMAGES/' + actividad.foto) }}');">
                                </div>
                                <div
                                    class="actividad-overlay d-flex flex-column justify-content-center align-items-start h-100 p-5">
                                    <h2 class="fw-bold mb-3"
                                        style="font-size: 2.7rem; letter-spacing: 1px; text-shadow: 0 2px 12px #0008;">
                                        {{ actividad.nombre }}</h2>
                                    <button class="btn btn-lg btn-primary ver-mas-btn px-5 py-3 mt-2"
                                        data-bs-toggle="modal"
                                        data-bs-target="#modalActividadApuntado{{ actividad.idactividad }}"
                                        style="font-size: 1.6rem; border-radius: 2rem; font-weight: 700; box-shadow: 0 2px 12px rgba(59,91,219,0.18);">
                                        Ver más
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Modal Detalle Actividad para Apuntado -->
                        <div class="modal fade" id="modalActividadApuntado{{ actividad.idactividad }}" tabindex="-1"
                            aria-labelledby="modalActividadLabelApuntado{{ actividad.idactividad }}" aria-hidden="true">
                            <div class="modal-dialog modal-xl modal-dialog-centered">
                                <div class="modal-content rounded-4">
                                    <div class="modal-header" style="background: #f8fafc;">
                                        <h2 class="modal-title fw-bold w-100 text-center"
                                            id="modalActividadLabelApuntado{{ actividad.idactividad }}"
                                            style="font-size: 2.8rem; color: #3b5bdb; letter-spacing: 1px;">
                                            {{ actividad.nombre }}
                                        </h2>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                            aria-label="Cerrar"></button>
                                    </div>
                                    <div class="modal-body px-5 py-4">
                                        <div class="mb-4 text-center">
                                            <span class="badge bg-primary fs-4 px-4 py-2 mb-3"
                                                style="font-size: 1.5rem;">{{ actividad.tipo }}</span>
                                        </div>
                                        <ul class="list-unstyled mb-4" style="font-size: 2rem;">
                                            <li class="mb-3"><strong>📍 Lugar:</strong> <span style="color:#3b5bdb;">{{
                                                    actividad.lugar }}</span></li>
                                            <li class="mb-3"><strong>🗓️ Fecha:</strong> <span style="color:#3b5bdb;">
                                                    {% set fecha = actividad.fecha.split(' ')[0] if ' ' in
                                                    actividad.fecha else actividad.fecha.split('T')[0] %}
                                                    {% set partes = fecha.split('-') %}
                                                    {{ partes[2] }}/{{ partes[1] }}/{{ partes[0] }}
                                                </span></li>
                                            <li class="mb-3"><strong>🕒 Hora:</strong> <span style="color:#3b5bdb;">{{
                                                    actividad.hora }}</span></li>
                                            <li class="mb-3"><strong>⏳ Duración:</strong> <span
                                                    style="color:#3b5bdb;">{{ actividad.duracion }} min</span></li>
                                        </ul>
                                        <div class="mb-4">
                                            <h4 class="fw-bold text-secondary" style="font-size: 2.2rem;">Descripción
                                            </h4>
                                            <p style="font-size: 1.7rem;">{{ actividad.descripcion }}</p>
                                        </div>
                                        <div class="mb-4">
                                            <h5 class="fw-bold mb-2" style="font-size: 2rem;">
                                                Participantes inscritos: {{ actividad.num_participantes }}
                                            </h5>
                                            {% if actividad.num_participantes > 0 %}
                                            <ul class="list-group list-group-flush mb-4" style="font-size: 1.5rem;">
                                                {% for participante in actividad.participantes %}
                                                <li
                                                    class="list-group-item d-flex align-items-center justify-content-between">
                                                    <span class="flex-grow-1">{{ participante.nombre }}</span>
                                                    <button type="button" class="btn btn-outline-info btn-sm ms-2"
                                                        data-bs-toggle="modal"
                                                        data-bs-target="#modalPerfilUsuario{{ participante.idusuario }}"
                                                        title="Ver perfil"> Ver Perfil
                                                        <i class="bi bi-person-circle"></i>
                                                    </button>
                                                </li>

                                                {% endfor %}
                                            </ul>
                                            {% else %}
                                            <p class="text-muted" style="font-size: 1.3rem;">No hay participantes aún.
                                            </p>
                                            {% endif %}
                                        </div>
                                        <form
                                            action="{{ url_for('desinscribirse', actividad_id=actividad.idactividad) }}"
                                            method="POST" class="mt-4">
                                            <button type="submit" class="btn btn-danger btn-lg w-100"
                                                style="font-size: 1.5rem; border-radius: 1.5rem;">
                                                Desapuntarme
                                            </button>
                                        </form>
                                        <div class="modal-footer" style="background: #f8fafc;">
                                            <button type="button" class="btn btn-secondary btn-lg"
                                                data-bs-dismiss="modal" style="font-size: 1.2rem;">Cerrar</button>
                                        </div>

                                    </div>

                                </div>
                            </div>
                        </div>
                        <!-- Fin Modal -->
                        {% endfor %}
                        {% if actividades_apuntado|length == 0 %}
                        <div class="col-12 text-center text-muted">No estás apuntado a ninguna actividad.</div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modales de actividades (fuera de las tabs para evitar duplicados) -->
    {% for actividad in actividades_disponibles + actividades_creadas + actividades_apuntado %}
    <div class="modal fade" id="modalActividad{{ actividad.idactividad }}" tabindex="-1"
        aria-labelledby="modalActividadLabel{{ actividad.idactividad }}" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content rounded-4">
                <div class="modal-header" style="background: #f8fafc;">
                    <h2 class="modal-title fw-bold w-100 text-center"
                        id="modalActividadLabel{{ actividad.idactividad }}"
                        style="font-size: 2.8rem; color: #3b5bdb; letter-spacing: 1px;">
                        {{ actividad.nombre }}
                    </h2>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body px-5 py-4">
                    <div class="mb-4 text-center">
                        <span class="badge bg-primary fs-4 px-4 py-2 mb-3" style="font-size: 1.5rem;">{{ actividad.tipo
                            }}</span>
                    </div>
                    <ul class="list-unstyled mb-4" style="font-size: 2rem;">
                        <li class="mb-3"><strong>📍 Lugar:</strong> <span style="color:#3b5bdb;">{{ actividad.lugar
                                }}</span></li>
                        <li class="mb-3"><strong>🗓️ Fecha:</strong> <span style="color:#3b5bdb;">{{ actividad.fecha
                                }}</span></li>
                        <li class="mb-3"><strong>🕒 Hora:</strong> <span style="color:#3b5bdb;">{{ actividad.hora
                                }}</span></li>
                        <li class="mb-3"><strong>⏳ Duración:</strong> <span style="color:#3b5bdb;">{{ actividad.duracion
                                }} min</span></li>
                    </ul>
                    <div class="mb-4">
                        <h4 class="fw-bold text-secondary" style="font-size: 2.2rem;">Descripción</h4>
                        <p style="font-size: 1.7rem;">{{ actividad.descripcion }}</p>
                    </div>
                    <div class="mb-4">
                        <h5 class="fw-bold mb-2" style="font-size: 2rem;">Participantes inscritos</h5>
                        {% if actividad.num_participantes > 0 %}
                        <ul class="list-group list-group-flush mb-4" style="font-size: 1.5rem;">
                            {% for participante in actividad.participantes %}
                            <li class="list-group-item">{{ participante }}</li>
                            {% endfor %}
                        </ul>
                        {% else %}
                        <p class="text-muted" style="font-size: 1.3rem;">No hay participantes aún.</p>
                        {% endif %}
                    </div>
                    <form action="{{ url_for('inscribirse', actividad_id=actividad.idactividad) }}" method="POST"
                        class="mt-4">
                        <button type="submit" class="btn btn-success btn-lg w-100"
                            style="font-size: 1.5rem; border-radius: 1.5rem;">
                            Apuntarme
                        </button>
                    </form>
                </div>
                <div class="modal-footer" style="background: #f8fafc;">
                    <button type="button" class="btn btn-secondary btn-lg" data-bs-dismiss="modal"
                        style="font-size: 1.2rem;">Cerrar</button>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}


    <div class="modal fade" id="confirmarModal" tabindex="-1" aria-labelledby="confirmarModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmarModalLabel">¿Quieres apuntarte?</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                    ¿Estás seguro de que deseas apuntarte a <strong id="nombreActividadModal">esta
                        actividad</strong>?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="confirmarBtn">Sí, apuntarme</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Contacto -->
    {% include 'modal_contacto.html' %}

    <!-- Modal de Perfil -->


    <footer class="bg-dark text-center text-lg-start mt-5 text-white">
        <div class="container p-4">
            <div class="row">
                <div class="col-lg-6 col-md-12 mb-4 mb-md-0 d-flex align-items-center">
                    <img src="../static/IMAGES/logo_unigen.svg" alt="UniGen Logo" width="50px" height="auto"
                        class="me-3" style="filter: invert(1);">
                    <div>
                        <h5 class="text-uppercase fw-bold" style="letter-spacing: 1px;">UniGen</h5>
                        <p class="fst-italic">
                            UniGen es una plataforma diseñada para conectar personas y fomentar el aprendizaje a través
                            de
                            actividades únicas.
                        </p>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 mb-4 mb-md-0">
                    <h5 class="text-uppercase fw-bold" style="letter-spacing: 1px;">Enlaces</h5>
                    <ul class="list-unstyled mb-0">
                        <li><a href="inicio" class="text-white text-decoration-none">Inicio</a></li>
                        <li><a href="dashboard" class="text-white text-decoration-none">Actividades</a></li>
                        <li><a href="tienda" class="text-white text-decoration-none">Tienda</a></li>
                        <li><a href="sobrenosotros" class="text-white text-decoration-none">Sobre Nosotros</a></li>
                    </ul>
                </div>
                <div class="col-lg-3 col-md-6 mb-4 mb-md-0">
                    <h5 class="text-uppercase fw-bold" style="letter-spacing: 1px;">Síguenos</h5>
                    <ul class="list-unstyled d-flex justify-content-start">
                        <li>
                            <a href="#" class="text-white me-3" style="transition: transform 0.3s;">
                                <i class="bi bi-facebook" style="font-size: 1.5rem;"></i>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="text-white me-3" style="transition: transform 0.3s;">
                                <i class="bi bi-twitter" style="font-size: 1.5rem;"></i>
                            </a>
                        </li>
                        <li>
                            <a href="https://www.instagram.com/unigen_ufv/" class="text-white me-3"
                                style="transition: transform 0.3s;">
                                <i class="bi bi-instagram" style="font-size: 1.5rem;"></i>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="text-white" style="transition: transform 0.3s;">
                                <i class="bi bi-linkedin" style="font-size: 1.5rem;"></i>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="text-white ms-3" style="transition: transform 0.3s;">
                                <i class="bi bi-youtube" style="font-size: 1.5rem;"></i>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <hr class="my-4" style="border-color: rgba(255, 255, 255, 0.5);">
        <div class="text-center p-3 text-white">
            <p>&copy; 2025 ROAR SL - Ingeniería Informática UFV</p>
            <p>Proyecto UniGen</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            document.querySelectorAll('.btn-validar-creditos').forEach(function (btn) {
                btn.addEventListener('click', function () {
                    const idusuario = btn.getAttribute('data-idusuario');
                    const idactividad = btn.getAttribute('data-idactividad');
                    const puntos = btn.getAttribute('data-puntos');
                    fetch('/validar_creditos', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ idusuario: idusuario, idactividad: idactividad, puntos: puntos })
                    })
                        .then(res => res.json())
                        .then(data => {
                            if (data.success) {
                                btn.style.display = 'none';
                                Swal.fire('¡Créditos enviados!', 'Los créditos han sido validados correctamente.', 'success');
                            } else {
                                Swal.fire('Error', data.message || 'No se pudo validar créditos.', 'error');
                            }
                        })
                        .catch(() => {
                            Swal.fire('Error', 'No se pudo validar créditos.', 'error');
                        });
                });
            });
        });
    </script>
    <script src="{{ url_for('static', filename='../static/JS/dashboard.js') }}"></script>
    <script src="{{ url_for('static', filename='../static/JS/modales.js') }}"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://kit.fontawesome.com/15e77aee33.js" crossorigin="anonymous"></script>
    <script>
        document.getElementById('filtroForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const form = e.target;
            const params = new URLSearchParams(new FormData(form)).toString();
            fetch('/filtrar_actividades_disponibles?' + params)
                .then(res => res.text())
                .then(html => {
                    document.getElementById('actividadesDisponibles').innerHTML = html;
                });
        });
    </script>
</body>



{% for actividad in actividades_disponibles + actividades_creadas + actividades_apuntado %}
{% if actividad.participantes %}
{% for participante in actividad.participantes %}
<div class="modal fade" id="modalPerfilUsuario{{ participante.idusuario }}" tabindex="-1"
    aria-labelledby="modalPerfilUsuarioLabel{{ participante.idusuario }}" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content rounded-4">
            <div class="modal-header" style="background: #f8fafc;">
                <h2 class="modal-title fw-bold w-100 text-center"
                    id="modalPerfilUsuarioLabel{{ participante.idusuario }}" style="font-size: 2rem; color: #3b5bdb;">
                    Perfil de {{ participante.nombre }}
                </h2>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body px-4 py-3 text-center">
                {% if participante.foto %}
                <img src="{{ url_for('static', filename='IMAGES/' ~ participante.foto) }}"
                    alt="Foto de {{ participante.nombre }}" class="rounded-circle mb-3"
                    style="width: 120px; height: 120px; object-fit: cover; border: 3px solid #3b5bdb;">
                {% else %}
                <i class="bi bi-person-circle text-secondary mb-3" style="font-size: 6rem;"></i>
                {% endif %}
                <h4 class="fw-bold mb-2">{{ participante.nombre }}</h4>
                {% if participante.email %}
                <p class="mb-1"><i class="bi bi-envelope"></i> {{ participante.email }}</p>
                {% endif %}
                {% if participante.descripcion %}
                <p class="mb-2"><i class="bi bi-info-circle"></i> {{ participante.descripcion }}</p>
                {% endif %}
                {% if participante.carrera %}
                <p class="mb-2"><i class="bi bi-mortarboard"></i> {{ participante.carrera }}</p>
                {% endif %}
                {% if participante.telefono %}
                <p class="mb-2"><i class="bi bi-telephone"></i> {{ participante.telefono }}</p>
                {% endif %}
                {% if participante.creditos is defined %}
                <p class="mb-2"><i class="bi bi-patch-check"></i> Créditos: {{ participante.creditos }}</p>
                {% endif %}
            </div>
            <div class="modal-footer" style="background: #f8fafc;">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>
{% endfor %}
{% endif %}
{% endfor %}

</html>